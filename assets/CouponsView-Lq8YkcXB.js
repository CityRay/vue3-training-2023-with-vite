import{S as l}from"./sweetalert2.all-bH93S6nv.js";import{m as M}from"./modalMixin-159TE-n9.js";import{_ as g,o as d,c as a,a as t,g as p,v as r,m as $,t as m,r as _,b,F as f,e as k}from"./index-9IrnIm9m.js";const L={mixins:[M],props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!0}},data(){return{tempCoupon:{},dueDate:""}},mounted(){this.tempCoupon={...this.coupon}},watch:{coupon(){if(this.tempCoupon={...this.coupon},this.isNew)this.dueDate=new Date().toISOString().split("T")[0];else{const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.dueDate=o[0]}}},methods:{updateCoupon(){this.tempCoupon.due_date=Math.floor(new Date(this.dueDate).getTime()/1e3),this.$emit("update-coupon",this.isNew,this.tempCoupon)}}},D={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},B={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},U={class:"modal-title",id:"couponModalLabel"},S={key:0},T={key:1},O=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},I={class:"row"},j={class:"col-md-12"},F={class:"mb-3"},E=t("label",{for:"title"},"標題",-1),P={class:"mb-3"},R=t("label",{for:"coupon_code"},"優惠碼",-1),q={class:"mb-3"},z=t("label",{for:"due_date"},"到期日",-1),G={class:"mb-3"},H=t("label",{for:"price"},"折扣百分比",-1),J={class:"mb-3"},K={class:"form-check"},Q=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),W={class:"modal-footer"},X=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Y(o,e,s,v,n,u){return d(),a("div",D,[t("div",V,[t("div",B,[t("div",N,[t("h5",U,[s.isNew?(d(),a("span",S,"新增優惠卷")):(d(),a("span",T,"編輯優惠卷"))]),O]),t("div",A,[t("div",I,[t("div",j,[t("div",F,[E,p(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=i=>n.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[r,n.tempCoupon.title]])]),t("div",P,[R,p(t("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=i=>n.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[r,n.tempCoupon.code]])]),t("div",q,[z,p(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=i=>n.dueDate=i)},null,512),[[r,n.dueDate]])]),t("div",G,[H,p(t("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":e[3]||(e[3]=i=>n.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[r,n.tempCoupon.percent,void 0,{number:!0}]])]),t("div",J,[t("div",K,[p(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=i=>n.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[$,n.tempCoupon.is_enabled]]),Q])])])])]),t("div",W,[X,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>u.updateCoupon&&u.updateCoupon(...i))},m(s.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const Z=g(L,[["render",Y]]),h="https://vue3-course-api.hexschool.io/v2/api/rayray-project/admin",C={title:"",is_enabled:0,percent:100,code:"",due_date:""},tt={components:{CouponModal:Z},data(){return{isLoading:!0,isNew:!0,coupons:[],tempCoupon:{...C}}},methods:{getCoupons(){this.isLoading=!0,this.$http.get(`${h}/coupons`).then(o=>{this.coupons=o.data.coupons}).catch(o=>{l.fire({title:o.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},updateOrAddCoupon(o,e){this.isLoading=!0,o?this.$http.post(`${h}/coupon`,{data:e}).then(s=>{this.$refs.couponModal.hideModal(),this.getCoupons(),l.fire({title:s.data.message,text:"",icon:"success"})}).catch(s=>{l.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1}):e.id&&this.$http.put(`${h}/coupon/${e.id}`,{data:e}).then(s=>{s.data.success?(this.$refs.couponModal.hideModal(),this.getCoupons(),l.fire({title:s.data.message,text:"",icon:"success"})):l.fire({title:s.data.message,text:"",icon:"error"})}).catch(s=>{l.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},openCouponModal(o=!0,e){this.isNew=o,o?this.tempCoupon={...C}:this.tempCoupon={...e},this.$refs.couponModal.openModal()},onDelCoupon(o){o.id&&l.fire({title:"確定刪除優惠卷?",text:`優惠卷: ${o.title}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${h}/coupon/${o.id}`).then(s=>{l.fire({title:"已刪除優惠卷!",text:"",icon:"success"}),this.getCoupons()}).catch(s=>{l.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1}))})}},mounted(){this.getCoupons()}},et={class:"row"},ot={class:"text-end mt-4"},st={class:"mt-3"},nt={class:"table mt-4"},it=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),lt={key:0,class:"text-success"},dt={key:1,class:"text-muted"},at={class:"btn-group"},ut=["onClick"],ct=["onClick"];function pt(o,e,s,v,n,u){const i=_("VueLoading"),y=_("CouponModal");return d(),a(f,null,[b(i,{active:n.isLoading},null,8,["active"]),t("div",et,[t("div",ot,[t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=c=>u.openCouponModal(!0))}," 建立新的優惠券 ")]),t("div",st,[t("table",nt,[it,t("tbody",null,[(d(!0),a(f,null,k(n.coupons,(c,x)=>(d(),a("tr",{key:x},[t("td",null,m(c.title),1),t("td",null,m(c.percent)+"%",1),t("td",null,m(o.$filters.date(c.due_date)),1),t("td",null,[c.is_enabled===1?(d(),a("span",lt,"啟用")):(d(),a("span",dt,"未啟用"))]),t("td",null,[t("div",at,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>u.openCouponModal(!1,c)},"編輯",8,ut),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>u.onDelCoupon(c)},"刪除",8,ct)])])]))),128))])])]),b(y,{ref:"couponModal",coupon:n.tempCoupon,"is-new":n.isNew,onUpdateCoupon:u.updateOrAddCoupon},null,8,["coupon","is-new","onUpdateCoupon"])])],64)}const _t=g(tt,[["render",pt]]);export{_t as default};
