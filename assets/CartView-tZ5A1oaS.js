import{S as d}from"./sweetalert2.all-L1Rgk2SD.js";import{_ as I,r as b,o as m,h as F,w,a as e,b as c,i as x,c as h,f as C,t as p,F as k,e as S,d as B,g as $,v as L}from"./index-ScyphKIx.js";const E={name:"",email:"",tel:"",address:""},O={props:{cart:{type:Object,default:()=>({})}},data(){return{form:{user:{...E},message:""}}},methods:{onFormSubmit(){this.$emit("submit-form",this.form,()=>{this.cleanFrom()})},cleanFrom(){this.$refs.form.resetForm()},isPhoneRule(s){return/^(09)[0-9]{8}$/.test(s)?!0:"需要正確的電話號碼"}}},T={class:"mb-3"},U=e("label",{for:"email",class:"form-label"},"Email",-1),q={class:"mb-3"},N=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),M={class:"mb-3"},j=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),P={class:"mb-3"},R=e("label",{for:"address",class:"form-label"},"收件人地址",-1),z={class:"mb-3"},D=e("label",{for:"message",class:"form-label"},"留言",-1),Q={class:"text-end"},A=["disabled"];function G(s,t,n,a,l,r){const f=b("VeeField"),_=b("ErrorMessage"),o=b("VeeForm");return m(),F(o,{ref:"form",class:"col-md-6",onSubmit:r.onFormSubmit},{default:w(({errors:u})=>{var v,y,V;return[e("div",T,[U,c(f,{id:"email",name:"Email",type:"email",class:x(["form-control",{"is-invalid":u.Email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":t[0]||(t[0]=i=>l.form.user.email=i)},null,8,["class","modelValue"]),c(_,{name:"Email",class:"invalid-feedback"})]),e("div",q,[N,c(f,{id:"name",name:"姓名",type:"text",class:x(["form-control",{"is-invalid":u.姓名}]),placeholder:"請輸入姓名",rules:"required|min:2|max:10",modelValue:l.form.user.name,"onUpdate:modelValue":t[1]||(t[1]=i=>l.form.user.name=i)},null,8,["class","modelValue"]),c(_,{name:"姓名",class:"invalid-feedback"})]),e("div",M,[j,c(f,{id:"tel",name:"電話",type:"text",class:x(["form-control",{"is-invalid":u.電話}]),placeholder:"請輸入電話",rules:r.isPhoneRule,modelValue:l.form.user.tel,"onUpdate:modelValue":t[2]||(t[2]=i=>l.form.user.tel=i),maxlength:"10"},null,8,["class","rules","modelValue"]),c(_,{name:"電話",class:"invalid-feedback"})]),e("div",P,[R,c(f,{id:"address",name:"地址",type:"text",class:x(["form-control",{"is-invalid":u.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":t[3]||(t[3]=i=>l.form.user.address=i)},null,8,["class","modelValue"]),c(_,{name:"地址",class:"invalid-feedback"})]),e("div",z,[D,c(f,{as:"textarea",id:"message",name:"message",class:"form-control",cols:"30",rows:"10",modelValue:l.form.message,"onUpdate:modelValue":t[4]||(t[4]=i=>l.form.message=i)},null,8,["modelValue"])]),e("div",Q,[(v=n.cart.carts)!=null&&v.length?(m(),h("button",{key:0,type:"submit",class:"btn btn-warning me-3",onClick:t[5]||(t[5]=(...i)=>r.cleanFrom&&r.cleanFrom(...i))}," 重新輸入 ")):C("",!0),e("button",{type:"submit",class:"btn btn-danger",disabled:!((y=n.cart.carts)!=null&&y.length)},p((V=n.cart.carts)!=null&&V.length?"送出訂單":"請先購物"),9,A)])]}),_:1},8,["onSubmit"])}const H=I(O,[["render",G]]),g="https://vue3-course-api.hexschool.io/v2/api/rayray-project",J={components:{OrderComponent:H},data(){return{cart:{},isLoading:!0,loadingItems:[]}},methods:{getCart(){this.$http.get(`${g}/cart`).then(s=>{this.cart=s.data.data,this.isLoading=!1}).catch(s=>{d.fire({title:s.response.data.message,text:"",icon:"error"})})},onOrderSubmit(s,t){this.isLoading=!0,this.$http.post(`${g}/order`,{data:s}).then(n=>{t&&t(),this.getCart(),d.fire({title:n.data.message,text:"",icon:"success"})}).catch(n=>{d.fire({title:n.response.data.message,text:"",icon:"error"})}).finally(()=>{this.loadingItems=this.loadingItems.filter(n=>n!=="createOrder")})},cartQtyChange(s,t=1){this.loadingItems.push(s);const n={product_id:s,qty:t};this.$http.put(`${g}/cart/${s}`,{data:n}).then(a=>{this.getCart()}).catch(a=>{d.fire({title:a.response.data.message,text:"",icon:"error"})}).finally(()=>{this.loadingItems=this.loadingItems.filter(a=>a!==s)})},cleanCart(){d.fire({title:"確定清空購物車?",text:"此動作將無法復原!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"}).then(s=>{s.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${g}/carts`).then(t=>{d.fire({title:"已清空購物車!",text:"",icon:"success"}),this.getCart(),this.loadingItems=[]}).catch(t=>{this.loadingItems=this.loadingItems.filter(n=>n!=="cleanCart"),d.fire({title:t.response.data.message,text:"",icon:"error"}),this.isLoading=!1}))})},removeToCart(s,t){d.fire({title:`確定移除此商品
「${t}」?`,text:"此動作將無法復原!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{n.isConfirmed&&(this.loadingItems.push(s),this.$http.delete(`${g}/cart/${s}`).then(a=>{this.getCart()}).catch(a=>{d.fire({title:a.response.data.message,text:"",icon:"error"})}).finally(()=>{this.loadingItems=this.loadingItems.filter(a=>a!==s)}))})}},mounted(){this.getCart()},computed:{disableBtn(){var s;return!!(!((s=this.cart.carts)!=null&&s.length)||this.loadingItems.includes("createOrder"))}}},K={class:"row"},W=e("h1",null,"購物車",-1),X={class:"text-end"},Y=["disabled"],Z={class:"table align-middle"},ee=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),te=["onClick"],se={key:0,class:"fas fa-spinner fa-pulse"},oe={key:1},le={key:0,class:"text-success"},ne={class:"input-group input-group-sm"},ae={class:"input-group mb-3"},re=["disabled","onUpdate:modelValue","onBlur"],ie={class:"input-group-text",id:"basic-addon2"},ce={class:"text-end"},de={key:0,class:"text-success"},me=e("td",{colspan:"3",class:"text-end"},"總計",-1),ue={class:"text-end"},he=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),fe={class:"text-end text-success"},_e={class:"my-5 row justify-content-center"};function pe(s,t,n,a,l,r){const f=b("VueLoading"),_=b("OrderComponent");return m(),h(k,null,[c(f,{active:l.isLoading},null,8,["active"]),e("div",K,[W,e("div",X,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:r.disableBtn,onClick:t[0]||(t[0]=(...o)=>r.cleanCart&&r.cleanCart(...o))}," 清空購物車 ",8,Y)]),e("table",Z,[ee,e("tbody",null,[l.cart.carts?(m(!0),h(k,{key:0},S(l.cart.carts,o=>(m(),h("tr",{key:o.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:u=>r.removeToCart(o.id,o.product.title)},[l.loadingItems.includes(o.id)?(m(),h("i",se)):(m(),h("span",oe,"x"))],8,te)]),e("td",null,[B(p(o.product.title)+" ",1),o.final_total!=o.total?(m(),h("div",le," 已套用優惠券 ")):C("",!0)]),e("td",null,[e("div",ne,[e("div",ae,[$(e("input",{min:"1",type:"number",class:"form-control",disabled:l.loadingItems.includes(o.id),"onUpdate:modelValue":u=>o.qty=u,onBlur:u=>r.cartQtyChange(o.id,o.qty)},null,40,re),[[L,o.qty,void 0,{number:!0,lazy:!0}]]),e("span",ie,p(o.product.unit),1)])])]),e("td",ce,[o.final_total!=o.total?(m(),h("small",de,"折扣價：")):C("",!0),B(" "+p(o.final_total),1)])]))),128)):C("",!0)]),e("tfoot",null,[e("tr",null,[me,e("td",ue,p(l.cart.total),1)]),e("tr",null,[he,e("td",fe,p(l.cart.final_total),1)])])])]),e("div",_e,[c(_,{cart:l.cart,onSubmitForm:r.onOrderSubmit},null,8,["cart","onSubmitForm"])])],64)}const xe=I(J,[["render",pe]]);export{xe as default};
