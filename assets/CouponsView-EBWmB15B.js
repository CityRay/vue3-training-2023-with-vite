import{S as a}from"./sweetalert2.all-ryP1vVa3.js";import{m as M}from"./modalMixin-rwXPBGKZ.js";import{_ as C,o as l,c as d,a as t,g as p,v as r,m as k,t as m,r as _,b as f,F as g,e as L,f as P}from"./index-bTk91nWT.js";import{P as D}from"./PaginationComponent-cwWjei5g.js";const V={mixins:[M],props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!0}},data(){return{tempCoupon:{},dueDate:""}},mounted(){this.tempCoupon={...this.coupon}},watch:{coupon(){if(this.tempCoupon={...this.coupon},this.isNew)this.dueDate=new Date().toISOString().split("T")[0];else{const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.dueDate=o[0]}}},methods:{updateCoupon(){this.tempCoupon.due_date=Math.floor(new Date(this.dueDate).getTime()/1e3),this.$emit("update-coupon",this.isNew,this.tempCoupon)}}},N={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},B={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},T={class:"modal-title",id:"couponModalLabel"},O={key:0},q={key:1},A=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),I={class:"modal-body"},j={class:"row"},F={class:"col-md-12"},E={class:"mb-3"},R=t("label",{for:"title"},"標題",-1),z={class:"mb-3"},G=t("label",{for:"coupon_code"},"優惠碼",-1),H={class:"mb-3"},J=t("label",{for:"due_date"},"到期日",-1),K={class:"mb-3"},Q=t("label",{for:"price"},"折扣百分比",-1),W={class:"mb-3"},X={class:"form-check"},Y=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Z={class:"modal-footer"},tt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function et(o,e,s,y,n,u){return l(),d("div",N,[t("div",B,[t("div",U,[t("div",S,[t("h5",T,[s.isNew?(l(),d("span",O,"新增優惠卷")):(l(),d("span",q,"編輯優惠卷"))]),A]),t("div",I,[t("div",j,[t("div",F,[t("div",E,[R,p(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=i=>n.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[r,n.tempCoupon.title]])]),t("div",z,[G,p(t("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=i=>n.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[r,n.tempCoupon.code]])]),t("div",H,[J,p(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=i=>n.dueDate=i)},null,512),[[r,n.dueDate]])]),t("div",K,[Q,p(t("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":e[3]||(e[3]=i=>n.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[r,n.tempCoupon.percent,void 0,{number:!0}]])]),t("div",W,[t("div",X,[p(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=i=>n.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,n.tempCoupon.is_enabled]]),Y])])])])]),t("div",Z,[tt,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>u.updateCoupon&&u.updateCoupon(...i))},m(s.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ot=C(V,[["render",et]]),h="https://vue3-course-api.hexschool.io/v2/api/rayray-project/admin",b={title:"",is_enabled:0,percent:100,code:"",due_date:""},nt={components:{CouponModal:ot,PaginationComponent:D},data(){return{isLoading:!0,isNew:!0,coupons:[],tempCoupon:{...b},pagination:null,currentPage:1}},methods:{getCoupons(){this.isLoading=!0,this.$http.get(`${h}/coupons?page=${this.currentPage}`).then(o=>{this.coupons=o.data.coupons,this.pagination=o.data.pagination}).catch(o=>{a.fire({title:o.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},updateOrAddCoupon(o,e){this.isLoading=!0,o?this.$http.post(`${h}/coupon`,{data:e}).then(s=>{this.$refs.couponModal.hideModal(),this.getCoupons(),a.fire({title:s.data.message,text:"",icon:"success"})}).catch(s=>{a.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1}):e.id&&this.$http.put(`${h}/coupon/${e.id}`,{data:e}).then(s=>{s.data.success?(this.$refs.couponModal.hideModal(),this.getCoupons(),a.fire({title:s.data.message,text:"",icon:"success"})):a.fire({title:s.data.message,text:"",icon:"error"})}).catch(s=>{a.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},openCouponModal(o=!0,e){this.isNew=o,o?this.tempCoupon={...b}:this.tempCoupon={...e},this.$refs.couponModal.openModal()},onDelCoupon(o){o.id&&a.fire({title:"確定刪除優惠卷?",text:`優惠卷: ${o.title}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonText:"取消"}).then(e=>{e.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${h}/coupon/${o.id}`).then(s=>{a.fire({title:"已刪除優惠卷!",text:"",icon:"success"}),this.getCoupons()}).catch(s=>{a.fire({title:s.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1}))})},onPageChange(o){this.currentPage!==o&&(this.$router.push({path:this.$route.path,query:{page:o}}),this.currentPage=o,this.getCoupons())}},mounted(){this.$route.query.page&&this.$route.query.page>0&&(this.currentPage=parseInt(this.$route.query.page,10)),this.getCoupons()}},st={class:"row"},it={class:"text-end mt-4"},at={class:"mt-3"},lt={class:"table mt-4"},dt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),ut={key:0,class:"text-success"},ct={key:1,class:"text-muted"},pt={class:"btn-group"},rt=["onClick"],ht=["onClick"],mt={key:0,class:"text-center"};function _t(o,e,s,y,n,u){const i=_("VueLoading"),v=_("PaginationComponent"),x=_("CouponModal");return l(),d(g,null,[f(i,{active:n.isLoading},null,8,["active"]),t("div",st,[t("div",it,[t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=c=>u.openCouponModal(!0))}," 建立新的優惠券 ")]),t("div",at,[t("table",lt,[dt,t("tbody",null,[(l(!0),d(g,null,L(n.coupons,(c,$)=>(l(),d("tr",{key:$},[t("td",null,m(c.title),1),t("td",null,m(c.percent)+"%",1),t("td",null,m(o.$filters.date(c.due_date)),1),t("td",null,[c.is_enabled===1?(l(),d("span",ut,"啟用")):(l(),d("span",ct,"未啟用"))]),t("td",null,[t("div",pt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:w=>u.openCouponModal(!1,c)},"編輯",8,rt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:w=>u.onDelCoupon(c)},"刪除",8,ht)])])]))),128))])]),n.pagination&&n.pagination.total_pages>0?(l(),d("div",mt,[f(v,{pagination:n.pagination,onPageChange:u.onPageChange},null,8,["pagination","onPageChange"])])):P("",!0)]),f(x,{ref:"couponModal",coupon:n.tempCoupon,"is-new":n.isNew,onUpdateCoupon:u.updateOrAddCoupon},null,8,["coupon","is-new","onUpdateCoupon"])])],64)}const yt=C(nt,[["render",_t]]);export{yt as default};
