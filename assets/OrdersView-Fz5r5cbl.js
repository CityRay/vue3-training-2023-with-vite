import{S as _}from"./sweetalert2.all-eFQV0e_I.js";import{m as O}from"./modalMixin-wbnXARpl.js";import{_ as y,o as l,c as n,a as t,t as s,f as k,F as p,e as f,g as v,m as x,r as m,b,i as w,d as L}from"./index-asqSAOp9.js";import{P as D}from"./PaginationComponent-t1t3qSAS.js";const V={mixins:[O],props:{order:{type:Object,default(){return{}}}},data(){return{tempOrder:{}}},watch:{order(){this.tempOrder=this.order}}},B={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},q={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},j=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},E={class:"row"},S={class:"col-md-4"},T=t("h3",null,"用戶資料",-1),F={class:"table"},I={key:0},z=t("th",{style:{width:"100px"}},"姓名",-1),A=t("th",null,"Email",-1),R=t("th",null,"電話",-1),G=t("th",null,"地址",-1),H={class:"col-md-8"},J=t("h3",null,"訂單細節",-1),K={class:"table"},Q=t("th",{style:{width:"100px"}},"訂單編號",-1),W=t("th",null,"下單時間",-1),X=t("th",null,"付款時間",-1),Y={key:0},Z={key:1},tt=t("th",null,"付款狀態",-1),et={key:0,class:"text-success"},st={key:1,class:"text-muted"},ot=t("th",null,"總金額",-1),lt=t("h3",null,"選購商品",-1),nt={class:"table"},dt=t("thead",null,[t("tr")],-1),it={class:"text-end"},at={class:"d-flex justify-content-end"},rt={class:"form-check"},ct={class:"form-check-label",for:"flexCheckDefault"},ut={key:0},ht={key:1},_t={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function mt(e,r,i,h,o,u){return l(),n("div",B,[t("div",q,[t("div",U,[j,t("div",N,[t("div",E,[t("div",S,[T,t("table",F,[o.tempOrder.user?(l(),n("tbody",I,[t("tr",null,[z,t("td",null,s(o.tempOrder.user.name),1)]),t("tr",null,[A,t("td",null,s(o.tempOrder.user.email),1)]),t("tr",null,[R,t("td",null,s(o.tempOrder.user.tel),1)]),t("tr",null,[G,t("td",null,s(o.tempOrder.user.address),1)])])):k("",!0)])]),t("div",H,[J,t("table",K,[t("tbody",null,[t("tr",null,[Q,t("td",null,s(o.tempOrder.id),1)]),t("tr",null,[W,t("td",null,s(e.$filters.date(o.tempOrder.create_at)),1)]),t("tr",null,[X,t("td",null,[o.tempOrder.paid_date?(l(),n("span",Y,s(e.$filters.date(o.tempOrder.paid_date)),1)):(l(),n("span",Z,"時間不正確"))])]),t("tr",null,[tt,t("td",null,[o.tempOrder.is_paid?(l(),n("strong",et,"已付款")):(l(),n("span",st,"尚未付款"))])]),t("tr",null,[ot,t("td",null,s(e.$filters.currency(o.tempOrder.total)),1)])])]),lt,t("table",nt,[dt,t("tbody",null,[(l(!0),n(p,null,f(o.tempOrder.products,d=>(l(),n("tr",{key:d.id},[t("th",null,s(d.product.title),1),t("td",null,s(d.qty)+" / "+s(d.product.unit),1),t("td",it,s(e.$filters.currency(d.final_total)),1)]))),128))])]),t("div",at,[t("div",rt,[v(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=d=>o.tempOrder.is_paid=d)},null,512),[[x,o.tempOrder.is_paid]]),t("label",ct,[o.tempOrder.is_paid?(l(),n("span",ut,"已付款")):(l(),n("span",ht,"未付款"))])])])])])]),t("div",_t,[pt,t("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=d=>e.$emit("update-paid",o.tempOrder))}," 修改付款狀態 ")])])])],512)}const bt=y(V,[["render",mt]]),ft={mixins:[O],props:{order:{type:Object,default(){return{}}}}},gt={class:"modal fade",id:"delOrderModal",tabindex:"-1",role:"dialog","aria-labelledby":"delOrderModalLabel","aria-hidden":"true",ref:"modal"},yt={class:"modal-dialog modal-xl",role:"document"},$t={class:"modal-content border-0"},Ot=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"delOrderModalLabel"},[t("span",null,"確認刪除訂單?")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),kt={class:"modal-body"},vt={class:"row"},xt={class:"col-md-12"},Mt=t("h3",null,"訂單細節",-1),Ct={class:"table"},Pt=t("th",{style:{width:"100px"}},"訂單編號",-1),wt=t("th",null,"下單時間",-1),Lt=t("th",null,"付款時間",-1),Dt={key:0},Vt={key:1},Bt=t("th",null,"付款狀態",-1),qt={key:0,class:"text-success"},Ut={key:1,class:"text-muted"},jt=t("th",null,"總金額",-1),Nt=t("h3",null,"選購商品",-1),Et={class:"table"},St=t("thead",null,[t("tr")],-1),Tt={class:"text-end"},Ft={class:"modal-footer"},It=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function zt(e,r,i,h,o,u){return l(),n("div",gt,[t("div",yt,[t("div",$t,[Ot,t("div",kt,[t("div",vt,[t("div",xt,[Mt,t("table",Ct,[t("tbody",null,[t("tr",null,[Pt,t("td",null,s(i.order.id),1)]),t("tr",null,[wt,t("td",null,s(e.$filters.date(i.order.create_at)),1)]),t("tr",null,[Lt,t("td",null,[i.order.paid_date?(l(),n("span",Dt,s(e.$filters.date(i.order.paid_date)),1)):(l(),n("span",Vt,"無付款時間"))])]),t("tr",null,[Bt,t("td",null,[i.order.is_paid?(l(),n("strong",qt,"已付款")):(l(),n("span",Ut,"尚未付款"))])]),t("tr",null,[jt,t("td",null,s(e.$filters.currency(i.order.total)),1)])])]),Nt,t("table",Et,[St,t("tbody",null,[(l(!0),n(p,null,f(i.order.products,d=>(l(),n("tr",{key:d.id},[t("th",null,s(d.product.title),1),t("td",null,s(d.qty)+" / "+s(d.product.unit),1),t("td",Tt,s(e.$filters.currency(d.final_total)),1)]))),128))])])])])]),t("div",Ft,[It,t("button",{type:"button",class:"btn btn-danger",onClick:r[0]||(r[0]=d=>e.$emit("delete-paid",i.order))}," 刪除訂單 ")])])])],512)}const At=y(ft,[["render",zt]]),g="https://vue3-course-api.hexschool.io/v2/api/rayray-project/admin",Rt={components:{OderModal:bt,DelOrderModal:At,PaginationComponent:D},data(){return{currentPage:1,orders:[],pagination:null,tempOrder:{},isLoading:!0}},methods:{getOrders(){this.isLoading=!0,this.$http.get(`${g}/orders?page=${this.currentPage}`).then(e=>{this.orders=e.data.orders,this.pagination=e.data.pagination}).catch(e=>{_.fire({title:e.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},updatePaid(e){this.isLoading=!0,this.$refs.orderModal.hideModal();const r=`${g}/order/${e.id}`,i={is_paid:e.is_paid};this.$http.put(r,{data:i}).then(h=>{this.getOrders(),_.fire({title:h.data.message,text:"",icon:"success"})}).catch(h=>{_.fire({title:h.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1})},openOrderModal(e){this.tempOrder={...e},this.$refs.orderModal.openModal()},openDelOrderModal(e){this.tempOrder={...e},this.$refs.delOrderModal.openModal()},onDelOrder(e){this.$refs.delOrderModal.hideModal(),e.id&&_.fire({title:"確定刪除訂單?",text:`訂單編號: ${e.id}`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"確定",cancelButtonText:"取消"}).then(r=>{r.isConfirmed&&(this.isLoading=!0,this.$http.delete(`${g}/order/${e.id}`).then(i=>{_.fire({title:"已刪除訂單!",text:"",icon:"success"}),this.getOrders()}).catch(i=>{_.fire({title:i.response.data.message,text:"",icon:"error"})}).finally(()=>{this.isLoading=!1}))})},onPageChange(e){this.currentPage!==e&&(this.$router.push({path:this.$route.path,query:{page:e}}),this.currentPage=e,this.getOrders())}},mounted(){this.$route.query.page&&this.$route.query.page>0&&(this.currentPage=parseInt(this.$route.query.page,10)),this.getOrders()}},Gt={class:"row"},Ht={class:"mt-3"},Jt={class:"table mt-4"},Kt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Qt={class:"text-end"},Wt={class:"form-check form-switch"},Xt=["id","checked","onUpdate:modelValue","onChange"],Yt=["for"],Zt={class:"btn-group"},te=["onClick"],ee=["onClick"],se={key:0,class:"text-center"};function oe(e,r,i,h,o,u){const d=m("VueLoading"),M=m("PaginationComponent"),C=m("OderModal"),P=m("DelOrderModal");return l(),n(p,null,[b(d,{active:o.isLoading},null,8,["active"]),t("div",Gt,[t("div",Ht,[t("table",Jt,[Kt,t("tbody",null,[(l(!0),n(p,null,f(o.orders,a=>{var $;return l(),n("tr",{key:a.id,class:w({"table-secondary":!a.is_paid})},[t("td",null,s(e.$filters.date(a.create_at)),1),t("td",null,s(($=a.user)==null?void 0:$.email),1),t("td",null,[t("ul",null,[(l(!0),n(p,null,f(a.products,c=>(l(),n("li",{key:c.id},s(c.product.title)+" - 數量： "+s(c.qty)+" "+s(c.product.unit),1))),128))])]),t("td",Qt,s(a.total),1),t("td",null,[L(s()+" ",1),t("div",Wt,[v(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`is_paid_${a.id}`,checked:a.is_paid,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>u.updatePaid(a)},null,40,Xt),[[x,a.is_paid]]),t("label",{class:"form-check-label",for:`is_paid_${a.id}`},s(a.is_paid?"已付款":"未付款"),9,Yt)])]),t("td",null,[t("div",Zt,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:c=>u.openOrderModal(a)}," 檢視 ",8,te),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>u.openDelOrderModal(a)}," 刪除 ",8,ee)])])],2)}),128))])]),o.pagination&&o.pagination.total_pages>0?(l(),n("div",se,[b(M,{pagination:o.pagination,onPageChange:u.onPageChange},null,8,["pagination","onPageChange"])])):k("",!0)]),b(C,{ref:"orderModal",order:o.tempOrder,onUpdatePaid:u.updatePaid},null,8,["order","onUpdatePaid"]),b(P,{ref:"delOrderModal",order:o.tempOrder,onDeletePaid:u.onDelOrder},null,8,["order","onDeletePaid"])])],64)}const ae=y(Rt,[["render",oe]]);export{ae as default};
